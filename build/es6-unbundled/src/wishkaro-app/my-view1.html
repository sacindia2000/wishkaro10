<html><head><link rel="import" href="../../bower_components/polymer/polymer-element.html"><link rel="import" href="../../bower_components/iron-list/iron-list.html"><link rel="import" href="../../bower_components/iron-image/iron-image.html"><link rel="import" href="../../bower_components/iron-flex-layout/iron-flex-layout-classes.html"><link rel="import" href="../../bower_components/paper-spinner/paper-spinner.html"><link rel="import" href="../../bower_components/polymer/lib/mixins/gesture-event-listeners.html"><link rel="import" href="../../bower_components/paper-dialog/paper-dialog.html"><link rel="import" href="shared-styles.html"><link rel="import" href="my-firestoreinit.html"></head><body><dom-module id="my-view1"><template><custom-style><style include="shared-styles iron-flex iron-flex-alignment">:host{height:80vh;display:flex;background-size:cover;flex-direction:column;}iron-list{flex:1 1 auto;}.container{@apply --layout-vertical;@apply --layout-flex;@apply --layout-wrap;margin-right:2px;margin-left:2px;margin-top:2px;margin-bottom:2px;padding-bottom:20px;}.flexchild{@apply --layout-flex;@apply --layout-horizontal;@apply --layout-wrap;margin-right:2px;margin-left:2px;}.imagecontainer{margin-top:2px;margin-bottom:2px;}</style><div class="container"><iron-list items="[[imagearray]]" as="item" id="itemlist" scroll-target="document" selected-item="{{selectedItem}}" grid=""><template><div class="flexchild" style="width:50%"><iron-image class="imagecontainer" sizing="cover" style="width:calc(100% - 4px); height:180px; background-color: lightgray;" preload="" fade="" src="[[item.linkwebp]]"></iron-image></div></template></iron-list><my-firestoreinit datacollection="wishimages" notifycollection="dataupdated" dataavailable="{{newdataind}}" dataarray="{{imagearray}}" testobj1="{{testobj}}" requestdata="{{datarequest}}" responsedata="{{dataresponse}}"></my-firestoreinit><paper-spinner active=""></paper-spinner><paper-dialog id="userdetails"></paper-dialog></div></custom-style></template><script>const myviewstate={Init:0,DataRequestSent:1,DataResponseReceived:2,NoMoreData:3};var State;class MyView1 extends Polymer.Element{static get is(){return'my-view1'}static get properties(){return{imagearray:{type:Array},scrollTarget:HTMLElement,selectedItem:{type:Number,observer:'_itemSelected'},newdataind:{type:Boolean,observer:'_Dataavailableind'},datarequest:{type:Boolean,notify:!0,value:!1},dataresponse:{type:Boolean,value:!1,observer:'_DataResponse'},testobj:{type:Object,notify:!0,value:{requestdatacount:0,readdatacount:0}},objectselected:{type:Object,notify:!0},_datastatus:{type:Object}}}_LowerThreshold(){console.log('Lower Threshold')}_DataResponse(){if(console.log('Data Read is '+this.testobj.readdatacount),0<=this.testobj.readdatacount){this._datastatus.DataResponseCount=this.testobj.readdatacount;for(var a,b=0,c=this.testobj.contentarray.length;b<c;b++)a={},a.timestamp=this.testobj.contentarray[b].get('created-time'),a.linkwebp=this.testobj.contentarray[b].get('link-webp'),a.linkimage=this.testobj.contentarray[b].get('link-jpg'),this.push('imagearray',a);State=myviewstate.DataResponseReceived,this._datastatus.DataResponseCount<this._datastatus.DataRequestCount&&(console.log('More data available'),State=myviewstate.NoMoreData)}}_itemSelected(){console.log('Iron-list item selected observer'+this),null!=this.selectedItem&&(console.log(this.selectedItem),this.selectedItem.name='LightBox',this.objectselected=this.selectedItem)}_Dataavailableind(){console.log('Data available observer called')}handleTrackEvent(){this.$.itemlist.lastVisibleIndex>=this.imagearray.length-3&&(console.log('Need more data'),this.$.userdetails.open(),(State==myviewstate.DataResponseReceived||State==myviewstate.Init)&&State!=myviewstate.NoMoreData&&this._UpdateNewdata(this._datastatus.DataRequestCount)),Polymer.Gestures.setTouchAction(this,'auto')}constructor(){super(),this.imagearray=[],this.testobj.contentarray=[],this._DataIntanceInit()}ready(){super.ready(),this.$.itemlist.selectionEnabled=!0,Polymer.Gestures.addListener(this,'track',(a)=>this.handleTrackEvent(a)),this._UpdateNewdata(this._datastatus.DataRequestCount),State=myviewstate.Init}_UpdateNewdata(a){State=myviewstate.DataRequestSent,this.testobj.requestdatacount=a,this.datarequest=!this.datarequest}_DataIntanceInit(){this._datastatus={},this._datastatus.TotalDataCount=0,this._datastatus.DataRequestCount=8,this._datastatus.DataResponseCount=0}}window.customElements.define(MyView1.is,MyView1);</script></dom-module></body></html>